{% extends "dashboardbase.html" %}

{% block content %}
<link href="/static/style.css" rel="stylesheet">

<script type="text/javascript" src="/realtimewebui/externals/knockout-3.1.0.js"></script>
<script type="text/javascript" src="/static/knockout.bindings.orderable.js"></script>
<script type='text/javascript' src='/static/common.js'></script>
<script type='text/javascript' src='/static/css.js'></script>

<div class="container">
    <h2>Inauguration Time by Host (in seconds)</h3>
    <table class="table">
        <thead>
            <tr>
                <th><a href="#" data-bind="orderable: {collection: 'inaugurationTimeByHost', field: '_id'}">Host</a></th>
                <th><a href="#" data-bind="orderable: {collection: 'inaugurationTimeByHost', field: 'averageInaugurationTime'}">Average Time</a></th>
            </tr>
            <tr>
                <th colspan="2">(Click a column name to sort by)</th>
            </tr>
        </thead>
        <tbody data-bind="foreach: inaugurationTimeByHost">
            <tr>
                <td data-bind="text: _id"></td>
                <td data-bind="text: averageInaugurationTime"></td>
            </tr>
        </tbody>
    </table>
    <h2>Inauguration Time by Label (in seconds)</h3>
    <table class="table">
        <thead>
            <tr>
                <th><a href="#" data-bind="orderable: {collection: 'inaugurationTimeByLabel', field: '_id'}">Label</a></th>
                <th><a href="#" data-bind="orderable: {collection: 'inaugurationTimeByLabel', field: 'averageInaugurationTime'}">Average Time</a></th>
            </tr>
            <tr>
                <th colspan="2">(Click a column name to sort by)</th>
            </tr>
        </thead>
        <tbody data-bind="foreach: inaugurationTimeByLabel">
            <tr>
                <td data-bind="text: _id"></td>
                <td data-bind="text: averageInaugurationTime"></td>
            </tr>
        </tbody>
    </table>
</div>

<script>
function httpGet(theUrl)
{
    var xmlHttp = new XMLHttpRequest();
    xmlHttp.open("GET", theUrl, false);
    xmlHttp.send(null);
    response = JSON.parse(xmlHttp.responseText);
    return response
}

function fixNumberFormat(statsObject)
{
    statsObject.forEach(function(unused, index, arr) {
        arr[index].averageInaugurationTime = Number(arr[index].averageInaugurationTime.toFixed(1));
    });
}

function setStats()
{
    statsObject = httpGet("http://localhost:6001/averageInaugurationTime?by=host")
    if (!statsObject)
        return;
    fixNumberFormat(statsObject)
    model.inaugurationTimeByHost(statsObject);

    statsObject = httpGet("http://localhost:6001/averageInaugurationTime?by=label")
    if (!statsObject)
        return;
    fixNumberFormat(statsObject)
    model.inaugurationTimeByLabel(statsObject);
}

function Model() {
    var self = this;
    self.inaugurationTimeByHost = ko.observableArray([]);
    self.inaugurationTimeByLabel = ko.observableArray([]);
}


var model = new Model();
ko.applyBindings(model);
setStats()

</script>

{% endblock %}
